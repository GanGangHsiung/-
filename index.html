<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ–°åº—é¡å®¶ - æ¨¡æ“¬èŠå¤©ç¾¤çµ„</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: #84a1c1; margin: 0; display: flex; justify-content: center; align-items: center; height: 100vh; overflow: hidden; }
        #setup { background: white; padding: 30px; border-radius: 15px; text-align: center; box-shadow: 0 10px 25px rgba(0,0,0,0.2); width: 300px; }
        #chat-container { display: none; width: 100%; max-width: 500px; height: 100vh; background: #84a1c1; flex-direction: column; }
        #status-bar { background: rgba(0,0,0,0.15); padding: 10px 15px; font-size: 13px; color: white; font-weight: bold; }
        #messages { flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; }
        .msg { margin-bottom: 12px; padding: 8px 12px; border-radius: 15px; font-size: 14px; line-height: 1.4; max-width: 75%; position: relative; word-wrap: break-word; }
        .msg.bot { background: white; align-self: flex-start; border-top-left-radius: 2px; }
        .msg.user { background: #95ec69; align-self: flex-end; border-top-right-radius: 2px; }
        .name { font-size: 11px; color: #444; margin-bottom: 3px; font-weight: bold; }
        .input-box { background: #fff; padding: 15px; display: flex; gap: 10px; border-top: 1px solid #ddd; }
        input { flex: 1; border: 1px solid #ddd; border-radius: 20px; padding: 10px 15px; outline: none; }
        button { background: #00c300; color: white; border: none; padding: 0 20px; border-radius: 20px; cursor: pointer; font-weight: bold; }
        select { padding: 10px; border-radius: 5px; margin: 15px 0; width: 100%; border: 1px solid #ccc; }
    </style>
</head>
<body>

<div id="setup">
    <h2>æ–°åº—é¡å®¶ æ¨¡æ“¬å™¨</h2>
    <p>é¸æ“‡èŠå¤©æ¨¡å¼ï¼š</p>
    <select id="mode">
        <option value="group">å…¨é«”ç¾¤çµ„ (è‡ªç™¼èŠå¤© ON)</option>
        <option value="single_ç†Šå‰›å‰›Jimmy">å–®èŠï¼šç†Šå‰›å‰›Jimmy</option>
        <option value="single_ç‹æ°´æº">å–®èŠï¼šç‹æ°´æº</option>
        <option value="single_é»ƒå­åº­ Troy">å–®èŠï¼šé»ƒå­åº­ Troy</option>
        <option value="single_Gee Homie">å–®æŒ‘ï¼šGee Homie</option>
    </select>
    <button onclick="initChat()" style="width: 100%; padding: 10px;">é€²å…¥èŠå¤©</button>
</div>

<div id="chat-container">
    <div id="status-bar" id="typing-indicator">æ–°åº—é¡å®¶ (4)</div>
    <div id="messages"></div>
    <div class="input-box">
        <input type="text" id="userInput" placeholder="å‚³é€è¨Šæ¯..." onkeypress="if(event.keyCode==13) doSend()">
        <button onclick="doSend()">å‚³é€</button>
    </div>
</div>

<script>
const friends = {
    "ç†Šå‰›å‰›Jimmy": {
        fallbacks: ["ç¬‘æ­»", "å°Šéƒ½å‡å˜Ÿ", "æˆ‘ä¸ä¿¡", "ç‰›é€¼", "å¥½æ‰¯", "åˆ°åº•"],
        keywords: { 
            "åˆ†æ‰‹": "é¢¨éšªå°æ²–åŠ æ§“æ¡¿çš„æ¦‚å¿µï¼ŒçœŸçš„", 
            "ç¡": "å¤§åŠå¤œä¸ç¡è¦ºåœ¨é€™é‚Šåµ",
            "ä¸ä¿¡": "é‚£æˆ‘å°±æ”¾å¿ƒäº†",
            "å­åº­": "ä»–åœ¨é‚£é‚Šè€å¤§ç‰Œå§"
        },
        topics: ["ç¬‘æ­»ï¼Œä½ å€‘çœ‹é€™å€‹", "å˜¿å˜¿ï¼Œå°Šéƒ½å‡å˜Ÿ", "åˆ°åº•åœ¨ç¬‘ä»€éº¼å•¦", "å¥½æ‰¯å–”"]
    },
    "ç‹æ°´æº": {
        fallbacks: ["éƒ½å¯ä»¥å•Š", "å‡è³½å•¦", "å¹¹ä½ å¨˜æœƒè¢«ä½ å€‘å®³æ­»", "ç„¡è¨€", "å¥½ç—›è‹¦"],
        keywords: { 
            "å˜‰æ©": "æˆ‘å…ˆä¿®ç†å¥¹ï¼Œåª½çš„æƒ³æ‰¾å€‹æ­£å¸¸äººäº¤å¾€å¥½é›£", 
            "éŒ¢": "æ”¶ä¸€ä¸‹é–€ç¥¨éŒ¢ï¼Œç‚ºäº†æˆ‘çš„éŒ¢åŒ…è¬è¬", 
            "è‚¡ç¥¨": "æ—ºå®äº®ç‡ˆå…©å¤©äº†ï¼Œæœ‰äººé‚„åœ¨è»Šä¸Šå—",
            "å¸¥": "ä½ é•·å¾—å¾ˆåƒä¸­åœ‹å¹¹ç‰‡è£¡çš„éœ¸é“ç¸½è£ï¼Œé¡§åŒ—è¾°"
        },
        topics: ["æˆ‘å¥½ç—›è‹¦", "åª½çš„æƒ³æ‰¾å€‹æ­£å¸¸äººå¥½å¥½äº¤å¾€é‚£éº¼é›£", "é¡§åŒ—è¾°ï¼Œåˆé«˜åˆå¸¥å…¨èº«é»‘", "æ—ºå®äº®ç‡ˆå…©å¤©äº†ï¼Œæœ‰äººé‚„åœ¨è»Šä¸Šå—"]
    },
    "é»ƒå­åº­ Troy": {
        fallbacks: ["ç™½ç™¡", "æ“ä½ åª½", "å°ç¡¬", "Fuckable", "ç…©éƒ½ç…©æ­»", "ä¸‰æ¢ç´°ç‹—"],
        keywords: { 
            "æ©Ÿç¥¨": "æ”¹ä¾†æ”¹å»æ“ä»–åª½ï¼Œæµªè²»æˆ‘éŒ¢", 
            "æ­£å¸¸": "ä½ ç®—å¹¸é‹äº†ï¼Œæˆ‘é€™é‚Šæ²’ä¸€å€‹æ­£å¸¸çš„", 
            "æ€’": "å¦‚æœä½ æ˜¯æƒ³æ¿€æ€’æˆ‘ï¼Œæ­å–œä½ ï¼Œä½ æˆåŠŸäº†",
            "å¤§é™¸": "æ€éº¼èªªï¼Œæˆ‘é©åˆå»ä¸­åœ‹ç™¼å±•å—"
        },
        topics: ["ç™½ç™¡å–”", "ç‚ºä»€éº¼åªæœ‰æˆ‘æ˜¯å±€å¤–äºº", "æ“ä½ åª½æ”¹ä¾†æ”¹å»", "ä¸‰æ¢ç´°ç‹—", "å¦‚æœä½ æ˜¯æƒ³æ¿€æ€’æˆ‘ï¼Œæ­å–œä½ "]
    },
    "Gee Homie": {
        fallbacks: ["æ„›äº†", "ä¸æ„›äº†", "ä¸‰å°å•¦", "è¡Œ", "ç¬‘æ­»", "å¥½æ…˜æœƒè¢«é£è¿”"],
        keywords: { 
            "ç´„": "æ˜å¤©æ™šä¸Šé›†åˆï¼Œå¹¾é»åˆ°å³èˆˆè¡—ï¼Ÿ", 
            "åƒå•¥": "çœ‹è¦åƒå•¥éƒ½è¡Œé™¤äº†ç«é‹", 
            "è³‡æ–™": "ç®¡å®¶ï¼Œä¸‰åˆ†é˜ä¹‹å…§æˆ‘è¦å¨¶å¤§é™¸äººå…¨éƒ¨çš„è³‡æ–™",
            "ä¹¾çˆ¹": "é€™æ˜¯é€šçŸ¥ä¸æ˜¯å•†é‡"
        },
        topics: ["ä¸‰å°å•¦", "æ…¢ä¾†ï¼Œåƒæ±è¥¿ä¸æªï¼Ÿ", "è¡Œ", "æ„›äº†", "é€™æ˜¯é€šçŸ¥ä¸æ˜¯å•†é‡", "çœŸÂ·ä¹¾çˆ¹"]
    }
};

let config = { mode: 'group', target: null };
let autoTimer = null;

function initChat() {
    const val = document.getElementById('mode').value;
    config.mode = val === 'group' ? 'group' : 'single';
    if(config.mode === 'single') config.target = val.replace('single_', '');
    
    document.getElementById('setup').style.display = 'none';
    document.getElementById('chat-container').style.display = 'flex';
    addMsg("ç³»çµ±", "é€£ç·šæˆåŠŸã€‚", "bot");

    if(config.mode === 'group') resetAutoTimer();
}

// 80% æ©Ÿç‡å¼•ç™¼é€£é–åæ‡‰
function triggerChainReaction(excludeName) {
    if (Math.random() > 0.8) return; 

    const others = Object.keys(friends).filter(n => n !== excludeName);
    const reactor = others[Math.floor(Math.random() * others.length)];
    
    setTimeout(() => {
        const reply = friends[reactor].fallbacks[Math.floor(Math.random() * friends[reactor].fallbacks.length)];
        addMsg(reactor, reply, "bot");

        // äºŒæ¬¡é€£é–æ©Ÿç‡
        if(Math.random() < 0.4) {
            setTimeout(() => {
                const third = others.filter(n => n !== reactor)[Math.floor(Math.random() * 2)];
                const secondReply = friends[third].fallbacks[Math.floor(Math.random() * friends[third].fallbacks.length)];
                addMsg(third, secondReply, "bot");
            }, 700);
        }
    }, 600);
}

function resetAutoTimer() {
    if(autoTimer) clearTimeout(autoTimer);
    const nextInterval = 4000 + Math.floor(Math.random() * 6000); // 4-10ç§’è‡ªç™¼ä¸€æ¬¡
    
    autoTimer = setTimeout(() => {
        if(config.mode === 'group') {
            const name = Object.keys(friends)[Math.floor(Math.random() * 4)];
            const topic = friends[name].topics[Math.floor(Math.random() * friends[name].topics.length)];
            addMsg(name, topic, "bot");
            triggerChainReaction(name);
        }
        resetAutoTimer();
    }, nextInterval);
}

function doSend() {
    const input = document.getElementById('userInput');
    const text = input.value.trim();
    if(!text) return;

    addMsg("ä½ ", text, "user");
    input.value = "";
    resetAutoTimer();

    const delay = 500 + Math.floor(Math.random() * 1200);
    const status = document.getElementById('status-bar');
    status.innerText = "ğŸ’¬ æœ‰äººæ­£åœ¨è¼¸å…¥...";

    setTimeout(() => {
        let name = config.mode === 'single' ? config.target : Object.keys(friends)[Math.floor(Math.random()*4)];
        let reply = getReply(name, text);
        addMsg(name, reply, "bot");
        status.innerText = config.mode === 'group' ? "æ–°åº—é¡å®¶ (4)" : `èˆ‡ ${name} å°è©±ä¸­`;
        
        if(config.mode === 'group') triggerChainReaction(name);
    }, delay);
}

function getReply(name, input) {
    const data = friends[name];
    for (let key in data.keywords) {
        if (input.includes(key)) return data.keywords[key];
    }
    return data.fallbacks[Math.floor(Math.random() * data.fallbacks.length)];
}

function addMsg(sender, text, type) {
    const box = document.getElementById('messages');
    const d = document.createElement('div');
    d.className = `msg ${type}`;
    const nameHtml = type === 'bot' ? `<div class="name">${sender}</div>` : '';
    d.innerHTML = `${nameHtml}${text}`;
    box.appendChild(d);
    box.scrollTop = box.scrollHeight;
}
</script>
</body>
</html>