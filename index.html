<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>新店顏家 - 瘋狂互噴版</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: #84a1c1; margin: 0; display: flex; justify-content: center; align-items: center; height: 100vh; overflow: hidden; }
        #setup { background: white; padding: 30px; border-radius: 15px; text-align: center; box-shadow: 0 10px 25px rgba(0,0,0,0.2); width: 300px; }
        #chat-container { display: none; width: 100%; max-width: 500px; height: 100vh; background: #84a1c1; flex-direction: column; }
        #status-bar { background: rgba(0,0,0,0.15); padding: 10px 15px; font-size: 13px; color: white; font-weight: bold; }
        #messages { flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; }
        .msg { margin-bottom: 12px; padding: 8px 12px; border-radius: 15px; font-size: 14px; line-height: 1.4; max-width: 75%; position: relative; word-wrap: break-word; }
        .msg.bot { background: white; align-self: flex-start; border-top-left-radius: 2px; }
        .msg.user { background: #95ec69; align-self: flex-end; border-top-right-radius: 2px; }
        .name { font-size: 11px; color: #444; margin-bottom: 3px; font-weight: bold; }
        .input-box { background: #fff; padding: 15px; display: flex; gap: 10px; border-top: 1px solid #ddd; }
        input { flex: 1; border: 1px solid #ddd; border-radius: 20px; padding: 10px 15px; outline: none; }
        button { background: #00c300; color: white; border: none; padding: 0 20px; border-radius: 20px; cursor: pointer; font-weight: bold; }
        select { padding: 10px; border-radius: 5px; margin: 15px 0; width: 100%; border: 1px solid #ccc; }
    </style>
</head>
<body>

<div id="setup">
    <h2>新店顏家 模擬器</h2>
    <p>模式：瘋狂互噴連鎖版</p>
    <select id="mode">
        <option value="group">全體群組 (高頻率互噴)</option>
        <option value="single_熊剛剛Jimmy">單聊：熊剛剛Jimmy</option>
        <option value="single_王水源">單聊：王水源</option>
        <option value="single_黃子庭 Troy">單聊：黃子庭 Troy</option>
        <option value="single_Gee Homie">單挑：Gee Homie</option>
    </select>
    <button onclick="initChat()" style="width: 100%; padding: 10px;">進入聊天</button>
</div>

<div id="chat-container">
    <div id="status-bar">新店顏家 (4)</div>
    <div id="messages"></div>
    <div class="input-box">
        <input type="text" id="userInput" placeholder="傳送訊息..." onkeypress="if(event.keyCode==13) doSend()">
        <button onclick="doSend()">傳送</button>
    </div>
</div>

<script>
const friends = {
    "熊剛剛Jimmy": {
        fallbacks: ["笑死", "尊都假嘟", "我不信", "牛逼", "到底"],
        keywords: { 
            "分手": "風險對沖加槓桿的概念，真的", 
            "子庭": "他在那邊耍大牌吧",
            "嘉恩": "嘉恩這話題很危險喔，水源會發瘋",
            "機票": "改機票不是你的專長嗎 @黃子庭 Troy",
            "旺宏": "笑死，還有人在車上嗎"
        },
        topics: ["嘿嘿，王水源又要聊嘉恩了", "黃子庭是不是在發瘋", "笑死，這群沒一個正常的", "到底在吵什麼啦"]
    },
    "王水源": {
        fallbacks: ["假賽啦", "幹你娘會被你們害死", "無言", "好痛苦", "都可以啊"],
        keywords: { 
            "嘉恩": "我先修理她，媽的想找個正常人交往好難", 
            "錢": "收一下門票錢，為了我的錢包謝謝", 
            "股票": "旺宏亮燈兩天了，有人還在車上嗎",
            "子庭": "子庭滿適合去中國發展的啊，霸道總裁",
            "不信": "你不信？我才不信你會還錢"
        },
        topics: ["我好痛苦", "嘉恩這女人真的沒救", "顧北辰，又高又帥全身黑", "旺宏亮燈兩天了，準備跳車"]
    },
    "黃子庭 Troy": {
        fallbacks: ["白癡", "操你媽", "小硬", "Fuckable", "煩都煩死", "三條細狗"],
        keywords: { 
            "機票": "改來改去操他媽，浪費我錢", 
            "正常": "你算幸運了，我這邊沒一個正常的", 
            "怒": "如果你是想激怒我，恭喜你，你成功了",
            "水源": "水源除了嘉恩還會聊什麼？",
            "顧北辰": "霸你媽，你才顧北辰"
        },
        topics: ["白癡喔", "為什麼只有我是局外人", "操你媽機票改來改去", "你們這群細狗"]
    },
    "Gee Homie": {
        fallbacks: ["愛了", "不愛了", "三小啦", "行", "好慘會被遣返"],
        keywords: { 
            "約": "明天晚上集合，幾點到吳興街？", 
            "吃啥": "看要吃啥都行除了火鍋", 
            "資料": "管家，三分鐘之內我要娶大陸人全部的資料",
            "遣返": "好慘會被遣返，真的愛了",
            "嘉恩": "管家，三分鐘內我要嘉恩的資料"
        },
        topics: ["三小啦", "慢來，吃東西不揪？", "這是通知不是商量", "真·乾爹在此"]
    }
};

let config = { mode: 'group', target: null };
let autoTimer = null;

function initChat() {
    const val = document.getElementById('mode').value;
    config.mode = val === 'group' ? 'group' : 'single';
    if(config.mode === 'single') config.target = val.replace('single_', '');
    document.getElementById('setup').style.display = 'none';
    document.getElementById('chat-container').style.display = 'flex';
    addMsg("系統", "連線成功。群組成員進入瘋狂互噴模式。", "bot");
    if(config.mode === 'group') resetAutoTimer();
}

// 遞歸掃描：讓對話產生連鎖反應
function scanForReaction(sender, text) {
    if (config.mode !== 'group') return;

    // 隨機打亂檢查順序，讓接話的人不固定
    const names = Object.keys(friends).filter(n => n !== sender).sort(() => Math.random() - 0.5);

    for (let name of names) {
        for (let key in friends[name].keywords) {
            if (text.includes(key)) {
                // 提高觸發機率至 95%
                if (Math.random() < 0.95) {
                    setTimeout(() => {
                        addMsg(name, friends[name].keywords[key], "bot");
                    }, 400 + Math.floor(Math.random() * 800)); // 縮短互噴延遲
                }
                return; // 每次掃描只觸發一個，但 addMsg 會再次呼叫此函式形成遞歸
            }
        }
    }

    // 如果沒有關鍵字，但隨機 30% 機率會有人出來講 fallback (吐槽)
    if (Math.random() < 0.3) {
        setTimeout(() => {
            const rName = names[Math.floor(Math.random() * names.length)];
            const fallback = friends[rName].fallbacks[Math.floor(Math.random() * friends[rName].fallbacks.length)];
            addMsg(rName, fallback, "bot");
        }, 1200);
    }
}

function resetAutoTimer() {
    if(autoTimer) clearTimeout(autoTimer);
    // 提高自發聊天頻率 (2-6秒)
    const nextInterval = 2000 + Math.floor(Math.random() * 4000);
    
    autoTimer = setTimeout(() => {
        if(config.mode === 'group') {
            const name = Object.keys(friends)[Math.floor(Math.random() * 4)];
            const topic = friends[name].topics[Math.floor(Math.random() * friends[name].topics.length)];
            addMsg(name, topic, "bot");
        }
        resetAutoTimer();
    }, nextInterval);
}

function doSend() {
    const input = document.getElementById('userInput');
    const text = input.value.trim();
    if(!text) return;

    addMsg("你", text, "user");
    input.value = "";
    resetAutoTimer();

    setTimeout(() => {
        let name = config.mode === 'single' ? config.target : Object.keys(friends)[Math.floor(Math.random()*4)];
        let reply = getReply(name, text);
        addMsg(name, reply, "bot");
    }, 400 + Math.floor(Math.random() * 800));
}

function getReply(name, input) {
    const data = friends[name];
    for (let key in data.keywords) {
        if (input.includes(key)) return data.keywords[key];
    }
    return data.fallbacks[Math.floor(Math.random() * data.fallbacks.length)];
}

function addMsg(sender, text, type) {
    const box = document.getElementById('messages');
    const d = document.createElement('div');
    d.className = `msg ${type}`;
    const nameHtml = type === 'bot' ? `<div class="name">${sender}</div>` : '';
    d.innerHTML = `${nameHtml}${text}`;
    box.appendChild(d);
    box.scrollTop = box.scrollHeight;

    // 核心邏輯：每發一條訊息，就掃描一次有沒有人要接話
    if (type === 'bot' && sender !== "系統") {
        scanForReaction(sender, text);
    }
}
</script>
</body>
</html>