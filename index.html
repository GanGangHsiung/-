<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ–°åº—é¡å®¶ - éˆé­‚å°è©± 3.0 (ä¸»å‹•é»ç«ç‰ˆ)</title>
    <style>
        body { font-family: -apple-system, sans-serif; background: #84a1c1; margin: 0; display: flex; justify-content: center; align-items: center; height: 100vh; }
        #chat-container { width: 100%; max-width: 500px; height: 100vh; background: #84a1c1; display: flex; flex-direction: column; }
        #status-bar { background: rgba(0,0,0,0.2); padding: 12px; color: white; font-weight: bold; text-align: center; }
        #messages { flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; }
        .msg { margin-bottom: 12px; padding: 10px 14px; border-radius: 18px; font-size: 14.5px; line-height: 1.5; max-width: 80%; }
        .msg.bot { background: white; align-self: flex-start; border-top-left-radius: 2px; }
        .msg.user { background: #95ec69; align-self: flex-end; border-top-right-radius: 2px; }
        .name { font-size: 11px; color: #555; margin-bottom: 4px; font-weight: bold; }
        .input-box { background: #fff; padding: 15px; display: flex; gap: 10px; border-top: 1px solid #ddd; }
        input { flex: 1; border: 1px solid #ddd; border-radius: 25px; padding: 12px 18px; outline: none; }
        button { background: #00c300; color: white; border: none; padding: 0 20px; border-radius: 25px; cursor: pointer; font-weight: bold; }
    </style>
</head>
<body>

<div id="chat-container">
    <div id="status-bar">æ–°åº—é¡å®¶ (4) - è§’è‰²è¯å‹•æ¨¡å¼</div>
    <div id="messages"></div>
    <div class="input-box">
        <input type="text" id="userInput" placeholder="è¼¸å…¥é—œéµå­—..." onkeypress="if(event.keyCode==13) doSend()">
        <button onclick="doSend()">å‚³é€</button>
    </div>
</div>

<script>
const friends = {
    "ç†Šå‰›å‰›Jimmy": {
        fallbacks: ["ç¬‘æ­»", "åˆ°åº•", "æœ›å‘¨çŸ¥", "å°Šéƒ½å‡å˜Ÿ", "è±ª", "æˆ‘ä¸ä¿¡"],
        keywords: { 
            "æ©Ÿç¥¨": "å¸¶å››å·åª³å©¦éƒ½ä¸ç”¨æ”¹æ©Ÿç¥¨ï¼Œçœå¤šå°‘éŒ¢ï¼Œå¦³å€‘çœŸçš„è´äº†",
            "æ—ºå®": "ç¬‘æ­»ï¼Œè·Œåˆ°ä¸‰ç™¾å¤šæˆ‘ä¸€ç›´åŠ ï¼Œ@ç‹æ°´æº ä½ çš„æ—ºå®é‚„åœ¨å—ï¼Ÿ", // ä¸»å‹•é»ç«
            "ç´”æƒ…": "æˆ‘å…„å¼Ÿé»ƒå­åº­å¾ˆä¹–ï¼Œèº«é‚Šæ²’ä»€éº¼ç•°æ€§ï¼Œæ˜¯æˆ‘å€‘è£¡é¢æœ€ç´”æƒ…çš„ä¸€å€‹ï¼",
            "åˆ†æ‰‹": "é¢¨éšªå°æ²–åŠ æ§“æ¡¿çš„æ¦‚å¿µï¼Œæ­¢æå•Šå¤§å“¥",
            "æ‰“å‚³èªª": "@Gee Homie çœŸÂ·ä¹¾çˆ¹ğŸ‘ŸğŸ‘ŸğŸ‘Ÿ å¾ˆé–’çš„è©±è¦ä¸è¦æ‰“å‚³èªªï¼Ÿ" // ä¸»å‹•é»ç«
        },
        topics: ["ç¬‘æ­»ï¼Œç‹æ°´æºåˆè¦èŠå˜‰æ©äº†", "é»ƒå­åº­æ˜¯ä¸æ˜¯åœ¨ç™¼ç˜‹", "æœ‰äººå¾ˆé–’çš„è©±è¦ä¸è¦æ‰“å‚³èªªï¼Ÿ", "æœ›å‘¨çŸ¥ï¼Œæˆ‘æ²’æœ‰æœ‹å‹"]
    },
    "ç‹æ°´æº": {
        fallbacks: ["å‡è³½å•¦", "å¥½ç—›è‹¦", "ç„¡è¨€", "éä¾† åä¸‹", "çœŸå‡å•¦", "åª½çš„"],
        keywords: { 
            "å˜‰æ©": "åª½çš„æƒ³æ‰¾å€‹æ­£å¸¸äººäº¤å¾€å¥½é›£ï¼Œæˆ‘é‚„æ˜¯æƒ³è·Ÿå¥¹å»æ±äº¬æ”¹æ™‚é–“", 
            "æ—ºå®": "æ—ºå®äº®ç‡ˆå…©å¤©äº†ï¼Œæœ‰äººé‚„åœ¨è»Šä¸Šå—ï¼Ÿçˆ›è²¨ï¼ï¼",
            "ç´”æƒ…": "æˆ‘å…„å¼Ÿé»ƒå­åº­å¾ˆä¹–...å‰å¥³å‹æ˜¯èœåˆ€å®‰ï¼Œæ”¶åˆ°ğŸ«¡",
            "ç—›è‹¦": "çœ‹äº†çœŸæ˜¯äº”å‘³é›œé™³ï¼Œ@é»ƒå­åº­ Troy æœ‰äººåœ¨ä¹æˆ‘çš„æ„Ÿå—å—ï¼Ÿ", // ä¸»å‹•é»ç«
            "èª²é‡‘": "@Gee Homie çœŸÂ·ä¹¾çˆ¹ğŸ‘ŸğŸ‘ŸğŸ‘Ÿ ä½ æ˜¯å¤§èª²é•·ï¼Œå°¾ç‰™è¦è«‹æˆ‘å§" // ä¸»å‹•é»ç«
        },
        topics: ["æˆ‘å¥½ç—›è‹¦", "å˜‰æ©é€™å¥³äººçœŸçš„æ²’æ•‘", "æ—ºå®äº®ç‡ˆå…©å¤©äº†ï¼Œæº–å‚™è·³è»Š", "é¡§åŒ—è¾°ï¼Œåˆé«˜åˆå¸¥å…¨èº«é»‘"]
    },
    "é»ƒå­åº­ Troy": {
        fallbacks: ["ç™½ç™¡å–”", "æ“ä½ åª½", "ç´°ç‹—", "Fuckable", "åœ‹é“ç‹‚é£†ä¸­", "ç®—å°ä¹Ÿç®—ä¸å°"],
        keywords: { 
            "æ©Ÿç¥¨": "æ”¹ä¾†æ”¹å»æ“ä»–åª½ï¼Œæµªè²»æˆ‘å¤šå°‘éŒ¢ï¼Œ18å¹´å¥¹å€‘è´äº†", 
            "æ„Ÿå—": "æœ‰äººåœ¨ä¹æˆ‘çš„æ„Ÿå—å—ï¼Ÿç‚ºä»€éº¼åªæœ‰æˆ‘æ˜¯å±€å¤–äººï¼Ÿ",
            "ç´”æƒ…": "å®Œç¾ã€‚ç‚ºäº†æ…¶ç¥æˆ‘è¡¨ç¾å„ªç•°ï¼Œé–‹é…’ä¾†å–",
            "åˆ†æ‰‹": "@ç†Šå‰›å‰›Jimmy ä½ æ˜¯ä¸æ˜¯å¾ˆé–’ï¼Œä¸€ç›´å«äººåˆ†æ‰‹", // ä¸»å‹•é»ç«
            "å˜‰æ©": "æ°´æºï¼Œå˜‰æ©é€™è©±é¡Œå¾ˆå±éšªå–”" // ä¸»å‹•é»ç«
        },
        topics: ["ç™½ç™¡å–”", "ç‚ºä»€éº¼åªæœ‰æˆ‘æ˜¯å±€å¤–äºº", "æ“ä½ åª½æ©Ÿç¥¨æ”¹ä¾†æ”¹å»", "ä½ å€‘é€™ç¾¤ç´°ç‹—"]
    },
    "Gee Homie": {
        fallbacks: ["æ„›äº†", "ä¸‰å°å•¦", "è¡Œ", "ç¬‘æ­»", "æˆ‘ä¸ä¿¡", "é€™æ˜¯åœ¨ç©å¤§åœ°éŠæˆ²å—"],
        keywords: { 
            "ç´„": "é€™æ˜¯é€šçŸ¥ä¸æ˜¯å•†é‡ï¼Œæ‡‚ï¼Ÿæ˜å¤©æ™šä¸Šé›†åˆ", 
            "è³‡æ–™": "ç®¡å®¶ï¼Œä¸‰åˆ†é˜ä¹‹å…§æˆ‘è¦å¨¶å¤§é™¸äººå…¨éƒ¨çš„è³‡æ–™",
            "å‚³èªª": "å¥½å•Šï¼Œæˆ‘æ˜¯èª²é•·ï¼Œè®“ä½ ä¾†å®¢é‡‘",
            "ç´”æƒ…": "æˆ‘åšå¥½è¬å…¨çš„æº–å‚™äº†ï¼Œåªè¦ä½ å€‘ä¸çŒæˆ‘é…’",
            "æ±‚å©š": "ä»–çš„æ²’æœ‰é‘½ï¼Œå¤±æ•—ã€‚æˆ‘ç¾åœ¨æ˜¯Cartierçš„å®¢æˆ¶äº†"
        },
        topics: ["ä¸‰å°å•¦", "è¡Œ", "é€™æ˜¯é€šçŸ¥ä¸æ˜¯å•†é‡", "Jimmyæ˜¯ä¸æ˜¯å¾ˆé–’", "æˆ‘æ˜¯èª²é•·"]
    }
};

let lastSender = ""; // é˜²æ­¢è‡ªè¨€è‡ªèªçš„é—œéµè®Šæ•¸
let autoTimer = null;

function initChat() {
    addMsg("ç³»çµ±", "é€£ç·šæˆåŠŸã€‚è§’è‰²è¯å‹•èˆ‡é˜²è‡ªè¨€è‡ªèªé‚è¼¯å·²è¼‰å…¥ã€‚", "bot");
    resetAutoTimer();
}

// ä¿®æ”¹ç™¼è©±é‚è¼¯ï¼Œç¢ºä¿ä¸æœƒé€£çºŒåŒä¸€å€‹äºº
function getNextResponder(excludeName) {
    const names = Object.keys(friends).filter(name => name !== excludeName);
    return names[Math.floor(Math.random() * names.length)];
}

async function handleReaction(sender, text) {
    const delay = (ms) => new Promise(res => setTimeout(res, ms));
    
    // éæ­·æ‰€æœ‰è§’è‰²ï¼Œçœ‹çœ‹æœ‰æ²’æœ‰äººè¢«é»ç«ï¼ˆé—œéµå­—è§¸ç™¼ï¼‰
    for (let name in friends) {
        if (name === sender) continue; // è‡ªå·±èªªçš„è©±ä¸è§¸ç™¼è‡ªå·±

        for (let key in friends[name].keywords) {
            if (text.includes(key)) {
                // æé«˜è¯å‹•æ©Ÿç‡ (85%)
                if (Math.random() < 0.85) {
                    await delay(800 + Math.random() * 1000);
                    addMsg(name, friends[name].keywords[key], "bot");
                    return; // è§¸ç™¼æˆåŠŸå¾Œè·³å‡ºï¼Œé˜²æ­¢å¤šäººåŒæ™‚æ¶è©±å¤ªäº‚
                }
            }
        }
    }

    // è‹¥ç„¡é—œéµå­—è¯å‹•ï¼Œéš¨æ©Ÿ 30% æ©Ÿç‡ç”±ã€Œå¦ä¸€å€‹äººã€åæ§½
    if (Math.random() < 0.3) {
        const nextPerson = getNextResponder(sender);
        await delay(1500);
        addMsg(nextPerson, friends[nextPerson].fallbacks[Math.floor(Math.random() * friends[nextPerson].fallbacks.length)], "bot");
    }
}

function resetAutoTimer() {
    if(autoTimer) clearTimeout(autoTimer);
    const nextInterval = 4000 + Math.floor(Math.random() * 6000);
    
    autoTimer = setTimeout(() => {
        const name = getNextResponder(lastSender); // ç¢ºä¿è‡ªç™¼èŠå¤©çš„äººä¸é‡è¤‡
        const topic = friends[name].topics[Math.floor(Math.random() * friends[name].topics.length)];
        addMsg(name, topic, "bot");
        resetAutoTimer();
    }, nextInterval);
}

function doSend() {
    const input = document.getElementById('userInput');
    const text = input.value.trim();
    if(!text) return;

    addMsg("ä½ ", text, "user");
    input.value = "";
    resetAutoTimer();

    // éš¨æ©Ÿé¸ä¸€å€‹äººå›è¦†ä½ ï¼Œä½†ä¸èƒ½æ˜¯ã€Œç³»çµ±ã€
    const firstResponder = getNextResponder(""); 
    setTimeout(() => {
        addMsg(firstResponder, getReply(firstResponder, text), "bot");
    }, 600);
}

function getReply(name, input) {
    const data = friends[name];
    for (let key in data.keywords) {
        if (input.includes(key)) return data.keywords[key];
    }
    return data.fallbacks[Math.floor(Math.random() * data.fallbacks.length)];
}

function addMsg(sender, text, type) {
    const box = document.getElementById('messages');
    const d = document.createElement('div');
    d.className = `msg ${type}`;
    const nameHtml = type === 'bot' ? `<div class="name">${sender}</div>` : '';
    d.innerHTML = `${nameHtml}${text}`;
    box.appendChild(d);
    box.scrollTop = box.scrollHeight;

    if (type === 'bot') {
        lastSender = sender; // è¨˜éŒ„æœ€å¾Œç™¼è©±çš„äºº
        if (sender !== "ç³»çµ±") handleReaction(sender, text);
    } else {
        lastSender = "User";
    }
}

// å•Ÿå‹•
initChat();
</script>
</body>
</html>